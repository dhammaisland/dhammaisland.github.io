<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="baidu-site-verification" content="codeva-Tk7siYLedl" />
    <meta name="keywords" content="佛教 南传佛教 原始佛教 上座部佛教 佛陀的正法 阿含经 巴利三藏 禅修 自洲自依 法洲法依 正法律 巴利经典 别译杂阿含 尼柯耶 长部 中部 相应部 增支部 小部 杂阿含经 中阿含经 长阿含经 增一阿含经" />
    <meta name="description" content="法洲法依，自洲自依，分享佛陀正法、律、禅师法语、禅修经验，书籍推荐、下载，资源共享" />
    <title>法洲</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dharma-brown': '#8d5a2a',
                        'dharma-light': '#a67c52',
                        'dharma-bg': '#fdfbf7',
                    }
                }
            }
        }
    </script>
    <style>
        .highlight {
            background-color: #fef3c7;
            padding: 0 2px;
            font-weight: 500;
        }
        
        .dhamma-text {
            transition: opacity 0.3s ease;
        }
        
        .type-filter.active {
            background-color: #8d5a2a !important;
            border-color: #8d5a2a !important;
            color: white !important;
        }
        
        /* Material Design 3 样式 */
        .md3-container {
            background: linear-gradient(135deg, #fdfbf7 0%, #f9f5f0 100%);
            border-radius: 28px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 6px 16px rgba(141, 90, 42, 0.08);
        }
        
        .md3-search-field {
            background-color: #f5ebe0;
            border: 1px solid transparent;
            border-radius: 28px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .md3-search-field:hover {
            background-color: #f0e6db;
            box-shadow: 0 2px 4px rgba(141, 90, 42, 0.1);
        }
        
        .md3-search-field:focus {
            background-color: #fff;
            border-color: #8d5a2a;
            box-shadow: 0 2px 8px rgba(141, 90, 42, 0.15);
            outline: none;
        }
        
        .md3-fab {
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 4px 8px rgba(141, 90, 42, 0.2);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .md3-fab:hover {
            box-shadow: 0 2px 6px rgba(0,0,0,0.15), 0 8px 16px rgba(141, 90, 42, 0.25);
            transform: translateY(-1px);
        }
        
        .md3-fab:active {
            transform: translateY(0);
        }
        
        .md3-outlined-button {
            border: 1px solid #8d5a2a;
            border-radius: 20px;
            background-color: transparent;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .md3-outlined-button:hover {
            background-color: rgba(141, 90, 42, 0.08);
        }
        
        .md3-chip {
            border-radius: 8px;
            background-color: #f5ebe0;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .md3-chip:hover {
            background-color: #f0e6db;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .md3-surface {
            background-color: #fefefe;
            border-radius: 16px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .md3-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #e0e0e0 20%, #e0e0e0 80%, transparent);
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            15% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            85% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
        }
    </style>
</head>
<body class="bg-dharma-bg font-sans">
    <!-- Header -->
    <header class="bg-gradient-to-r from-dharma-brown to-dharma-light text-white py-10 px-4 shadow-lg">
        <h1 class="text-4xl md:text-5xl font-light tracking-widest text-center mb-2"><i class="bi bi-flower1"></i>法洲</h1>
        <p class="text-center text-sm md:text-base opacity-95">真理是最上之甘味</p>
    </header>

    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- 法语展示区 - Material Design 3 风格 -->
        <section class="md3-container p-6 md:p-12 mb-12">
            <!-- 标题区域 -->
            <div class="mb-8">
                <h2 class="text-3xl md:text-4xl font-medium text-dharma-brown mb-2 flex items-center gap-3">
                    <i class="bi bi-flower1 text-4xl"></i>
                    <span>法语甘露</span>
                </h2>
            </div>
            
            <!-- 搜索栏 - MD3 风格 -->
            <div class="mb-8">
                <div class="flex flex-wrap gap-3">
                    <div class="flex-1 min-w-[280px] relative">
                        <i class="bi bi-search absolute left-5 top-1/2 -translate-y-1/2 text-gray-500 text-lg"></i>
                        <input 
                            type="text" 
                            id="search-input" 
                            class="md3-search-field w-full pl-14 pr-6 py-4 text-base"
                            placeholder="搜索法语..." 
                            onkeypress="if(event.key==='Enter') searchDhamma()"
                        >
                    </div>
                    <button 
                        class="md3-fab px-8 py-4 bg-dharma-brown text-white font-medium flex items-center gap-2"
                        onclick="searchDhamma()"
                    >
                        <i class="bi bi-search"></i>
                        <span class="hidden sm:inline">搜索</span>
                    </button>
                    <button 
                        class="md3-outlined-button px-6 py-4 text-dharma-brown font-medium flex items-center gap-2"
                        onclick="clearSearch()" 
                        id="clear-btn" 
                        style="display:none;"
                    >
                        <i class="bi bi-x-lg"></i>
                        <span>清除</span>
                    </button>
                </div>
            </div>
            
            <!-- 页码跳转 - MD3 Chip 风格 -->
            <div class="flex flex-wrap gap-3 mb-8 items-center justify-center">
                <div class="md3-chip px-4 py-2 flex items-center gap-2">
                    <span class="text-sm text-gray-700">跳转至</span>
                    <input 
                        type="number" 
                        id="page-jump" 
                        min="1"
                        class="w-16 px-2 py-1 bg-white border border-gray-300 rounded-lg text-center text-sm focus:outline-none focus:border-dharma-brown" 
                        placeholder="1"
                        onkeypress="if(event.key==='Enter') jumpToPage()"
                    >
                    <span class="text-sm text-gray-700">页</span>
                </div>
                <button 
                    class="md3-chip px-5 py-2 text-sm font-medium text-dharma-brown flex items-center gap-2 hover:shadow-md"
                    onclick="jumpToPage()"
                >
                    <i class="bi bi-arrow-right-short text-lg"></i>
                    跳转
                </button>
            </div>
            
            <!-- 搜索结果信息 - MD3 风格 -->
            <div id="search-info" class="text-gray-700 text-sm text-center mb-6 py-3 px-6 bg-blue-50 rounded-2xl border border-blue-100" style="display:none;"></div>
            
            <!-- 法语内容区域 - MD3 Surface -->
            <div class="md3-surface p-8 mb-8 min-h-[280px] flex items-center justify-center">
                <div id="dhamma-display" class="dhamma-text text-lg md:text-xl leading-loose text-gray-800 w-full">
                    <div class="text-center text-gray-400 flex flex-col items-center gap-3">
                        <i class="bi bi-hourglass-split text-3xl"></i>
                        <span>加载中...</span>
                    </div>
                </div>
            </div>
            
            <!-- 分页控制 - MD3 风格 -->
            <div class="md3-divider my-6"></div>
            <div class="flex flex-col sm:flex-row justify-between items-center gap-6 pt-4">
                <div class="flex gap-2 items-center">
                    <button 
                        id="prev-btn" 
                        onclick="prevPage()"
                        class="md3-fab px-5 py-3 bg-white border border-gray-200 text-dharma-brown disabled:opacity-40 disabled:cursor-not-allowed flex items-center gap-2 font-medium"
                    >
                        <i class="bi bi-chevron-left"></i>
                        <span>上一页</span>
                    </button>
                    <div class="md3-chip px-4 py-3 min-w-[140px] text-center">
                        <span id="page-info" class="text-sm font-medium text-gray-700">-</span>
                    </div>
                    <button 
                        id="next-btn" 
                        onclick="nextPage()"
                        class="md3-fab px-5 py-3 bg-white border border-gray-200 text-dharma-brown disabled:opacity-40 disabled:cursor-not-allowed flex items-center gap-2 font-medium"
                    >
                        <span>下一页</span>
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
                <button 
                    class="md3-fab px-6 py-3 bg-gradient-to-r from-dharma-brown to-dharma-light text-white font-medium flex items-center gap-2"
                    onclick="randomQuote()"
                >
                    <i class="bi bi-shuffle"></i>
                    <span>随机浏览</span>
                </button>
            </div>
        </section>

        <!-- 文章专栏区 -->
        <section class="mb-12">
            <h2 class="text-2xl md:text-3xl font-normal text-dharma-brown mb-6 text-center flex items-center justify-center gap-2">
                <i class="bi bi-journal-text"></i>
                <span>法义文章</span>
            </h2>
            
            <!-- 文章列表 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- 文章卡片 1 -->
                <a href="article/四大法教.html" class="block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center text-white">
                                <i class="bi bi-file-text text-2xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-medium text-dharma-brown mb-2 group-hover:text-dharma-light transition-colors">关于四大法教</h3>
                            <p class="text-sm text-gray-500 mb-2 line-clamp-2">增支部AN VII.80经文解读，清晰定义法与律的标准</p>
                            <div class="flex items-center gap-2 text-xs text-gray-400">
                                <i class="bi bi-tag"></i>
                                <span>法教 · 经典</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- 文章卡片 2 -->
                <a href="article/圣者与凡夫的不同视角.html" class="block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white">
                                <i class="bi bi-eye text-2xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-medium text-dharma-brown mb-2 group-hover:text-dharma-light transition-colors">圣者与凡夫的不同视角</h3>
                            <p class="text-sm text-gray-500 mb-2 line-clamp-2">相应部35相应80经解读，断除无明的知见</p>
                            <div class="flex items-center gap-2 text-xs text-gray-400">
                                <i class="bi bi-tag"></i>
                                <span>无明 · 六根</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- 文章卡片 3 -->
                <a href="article/心生迫切感.html" class="block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center text-white">
                                <i class="bi bi-heart-pulse text-2xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-medium text-dharma-brown mb-2 group-hover:text-dharma-light transition-colors">心生迫切感</h3>
                            <p class="text-sm text-gray-500 mb-2 line-clamp-2">班迪达大师开示，无常与无财产的真相</p>
                            <div class="flex items-center gap-2 text-xs text-gray-400">
                                <i class="bi bi-tag"></i>
                                <span>无常 · 禅修</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- 文章卡片 4 -->
                <a href="article/如何证果.html" class="block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center text-white">
                                <i class="bi bi-trophy text-2xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-medium text-dharma-brown mb-2 group-hover:text-dharma-light transition-colors">如何证果</h3>
                            <p class="text-sm text-gray-500 mb-2 line-clamp-2">舍利弗尊者开示如理作意五取蕴以证得圣果</p>
                            <div class="flex items-center gap-2 text-xs text-gray-400">
                                <i class="bi bi-tag"></i>
                                <span>五取蕴 · 证果</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- 文章卡片 5 -->
                <a href="article/内观定.html" class="block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-lg flex items-center justify-center text-white">
                                <i class="bi bi-droplet text-2xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-medium text-dharma-brown mb-2 group-hover:text-dharma-light transition-colors">内观定</h3>
                            <p class="text-sm text-gray-500 mb-2 line-clamp-2">德加尼亚禅师开示内观定与止禅定的区别</p>
                            <div class="flex items-center gap-2 text-xs text-gray-400">
                                <i class="bi bi-tag"></i>
                                <span>内观定 · 正精进</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- 文章卡片 6 -->
                <a href="article/亲近智者.html" class="block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-gradient-to-br from-rose-500 to-pink-600 rounded-lg flex items-center justify-center text-white">
                                <i class="bi bi-people text-2xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-medium text-dharma-brown mb-2 group-hover:text-dharma-light transition-colors">亲近智者</h3>
                            <p class="text-sm text-gray-500 mb-2 line-clamp-2">菩提比丘开示善友对灵性发展的重要性</p>
                            <div class="flex items-center gap-2 text-xs text-gray-400">
                                <i class="bi bi-tag"></i>
                                <span>善知识 · 大吉祥经</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- 可以继续添加更多文章 -->
            </div>
        </section>

        <!-- 书籍下载区 -->
        <section class="mb-12">
            <h2 class="text-2xl md:text-3xl font-normal text-dharma-brown mb-6 text-center flex items-center justify-center gap-2">
                <i class="bi bi-book"></i>
                <span>推荐书籍下载</span>
            </h2>
            
            <!-- 书籍网格 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="books-grid">
                <div class="text-center text-gray-400 col-span-full py-8">加载中...</div>
            </div>
        </section>

        <!-- 资源链接区 -->
        <section class="mb-12">
            <h2 class="text-2xl md:text-3xl font-normal text-dharma-brown mb-6 text-center flex items-center justify-center gap-2">
                <i class="bi bi-link-45deg"></i>
                <span>佛法资源链接</span>
            </h2>
            
            <!-- 类型过滤器 -->
            <div class="flex justify-center gap-3 mb-8 flex-wrap" id="type-filters">
                <button class="type-filter px-6 py-2 bg-white border-2 border-gray-200 text-gray-700 rounded-full hover:border-dharma-light transition-all duration-300 active:bg-dharma-brown active:border-dharma-brown active:text-white" data-type="all" onclick="filterByType('all')">
                    全部
                </button>
            </div>
            
            <!-- 链接网格 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="links-grid">
                <div class="text-center text-gray-400 col-span-full py-8">加载中...</div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 py-8 text-center text-gray-600 text-sm mt-12">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col items-center gap-3">
                <p class="text-dharma-brown font-medium">&copy; 2025 法洲 | 愿正法久住</p>
                <div class="flex items-center gap-2 text-gray-500 hover:text-dharma-brown transition-colors">
                    <i class="bi bi-envelope-fill"></i>
                    <a href="mailto:paccakkha@yahoo.com" class="hover:underline">paccakkha@yahoo.com</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="link.js"></script>
    <script src="dhamma.js"></script>
    <script src="book.js"></script>
    <script>
        let dhammaData = DHAMMA_DATA;
        let linksData = LINKS_DATA;
        let currentPage = 0;
        let currentFilter = 'all';
        const ITEMS_PER_PAGE = 5;
        
        // 搜索相关变量
        let searchKeyword = '';
        let filteredDhammaData = [];
        let isSearching = false;
        
        // 随机显示相关变量
        let randomIndices = [];

        // 生成随机索引数组
        function generateRandomIndices(dataLength) {
            const indices = Array.from({ length: dataLength }, (_, i) => i);
            // Fisher-Yates 洗牌算法
            for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
            return indices;
        }

        // 页面加载后初始化
        function initPage() {
            // 生成随机索引(仅在非搜索模式下)
            if (!isSearching) {
                randomIndices = generateRandomIndices(dhammaData.length);
            }
            
            // 初始化法语显示
            displayDhamma();
            
            // 显示书籍
            displayBooks();
            
            // 初始化分类过滤器
            initTypeFilters();
            
            // 显示链接
            displayLinks();
        }

        // 显示当前页法语
        function displayDhamma() {
            const dataSource = isSearching ? filteredDhammaData : dhammaData;
            if (dataSource.length === 0) {
                document.getElementById('dhamma-display').innerHTML = '<div style="text-align:center;color:#999;">未找到匹配的法语</div>';
                document.getElementById('page-info').textContent = '无结果';
                document.getElementById('prev-btn').disabled = true;
                document.getElementById('next-btn').disabled = true;
                return;
            }
            
            const display = document.getElementById('dhamma-display');
            let items;
            
            if (isSearching) {
                // 搜索模式:按顺序显示搜索结果
                const startIdx = currentPage * ITEMS_PER_PAGE;
                const endIdx = Math.min(startIdx + ITEMS_PER_PAGE, dataSource.length);
                items = dataSource.slice(startIdx, endIdx);
            } else {
                // 非搜索模式:使用随机索引
                const startIdx = currentPage * ITEMS_PER_PAGE;
                const endIdx = Math.min(startIdx + ITEMS_PER_PAGE, randomIndices.length);
                items = randomIndices.slice(startIdx, endIdx).map(idx => ({
                    text: dhammaData[idx].sentence,
                    url: dhammaData[idx].url,
                    index: idx
                }));
            }
            
            display.style.opacity = '0';
            setTimeout(() => {
                // 使用编号列表显示多条法语,带关键词高亮
                display.innerHTML = items.map((item, idx) => {
                    const text = item.text || item.sentence || item;
                    const url = item.url || '';
                    const highlightedText = isSearching ? highlightKeyword(text, searchKeyword) : text;
                    const actualIdx = item.index !== undefined ? item.index : currentPage * ITEMS_PER_PAGE + idx;
                    
                    // 转义引号以便在HTML属性中使用
                    const escapedText = text.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
                    
                    let content = `<div style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; ${idx < items.length - 1 ? 'border-bottom: 1px solid #e0e0e0;' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <div style="color: #a67c52; font-size: 0.85rem;">第 ${actualIdx + 1} 条</div>
                            <button onclick="copyDhamma('${escapedText}')" style="color: #8d5a2a; background: transparent; border: 1px solid #e0e0e0; border-radius: 8px; padding: 0.25rem 0.5rem; font-size: 0.8rem; cursor: pointer; display: inline-flex; align-items: center; gap: 0.25rem; transition: all 0.2s;" onmouseover="this.style.backgroundColor='#fdfbf7'; this.style.borderColor='#8d5a2a'" onmouseout="this.style.backgroundColor='transparent'; this.style.borderColor='#e0e0e0'" title="复制法语">
                                <i class="bi bi-clipboard"></i>
                                <span>复制</span>
                            </button>
                        </div>
                        <div>${highlightedText}</div>`;
                    
                    if (url && url !== '') {
                        content += `<div style="margin-top: 0.75rem; text-align: right;"><a href="${url}" style="color: #8d5a2a; text-decoration: none; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.5rem; border-radius: 0.375rem; transition: all 0.3s; background-color: #fdfbf7;" target="_blank" onmouseover="this.style.backgroundColor='#f5ebe0'" onmouseout="this.style.backgroundColor='#fdfbf7'"><i class="bi bi-arrow-right-circle"></i> 阅读更多</a></div>`;
                    }
                    
                    content += `</div>`;
                    return content;
                }).join('');
                
                display.style.opacity = '1';
            }, 150);
            
            // 更新页码信息
            const totalPages = Math.ceil(dataSource.length / ITEMS_PER_PAGE);
            document.getElementById('page-info').textContent = `第 ${currentPage + 1} 页 / 共 ${totalPages} 页`;
            
            // 更新按钮状态
            document.getElementById('prev-btn').disabled = currentPage === 0;
            document.getElementById('next-btn').disabled = (currentPage + 1) * ITEMS_PER_PAGE >= dataSource.length;
        }

        function prevPage() {
            if (currentPage > 0) {
                currentPage--;
                displayDhamma();
                scrollToTop();
            }
        }

        function nextPage() {
            const dataSource = isSearching ? filteredDhammaData : dhammaData;
            const totalPages = Math.ceil(dataSource.length / ITEMS_PER_PAGE);
            if (currentPage < totalPages - 1) {
                currentPage++;
                displayDhamma();
                scrollToTop();
            }
        }
        
        function scrollToTop() {
            const displayElement = document.getElementById('dhamma-display');
            if (displayElement) {
                displayElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        // 复制法语文本
        function copyDhamma(text) {
            // 移除HTML标签，只保留纯文本
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = text;
            const plainText = tempDiv.textContent || tempDiv.innerText || '';
            
            navigator.clipboard.writeText(plainText).then(() => {
                // 显示复制成功提示
                const toast = document.createElement('div');
                toast.textContent = '✓ 已复制';
                toast.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #8d5a2a; color: white; padding: 12px 24px; border-radius: 28px; font-size: 14px; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.15); animation: fadeInOut 2s ease-in-out;';
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }).catch(err => {
                alert('复制失败，请手动复制');
                console.error('复制失败:', err);
            });
        }

        function randomQuote() {
            if (isSearching) {
                // 搜索模式:随机跳转到某页
                const totalPages = Math.ceil(filteredDhammaData.length / ITEMS_PER_PAGE);
                currentPage = Math.floor(Math.random() * totalPages);
            } else {
                // 非搜索模式:重新生成随机索引并跳转到随机页
                randomIndices = generateRandomIndices(dhammaData.length);
                const totalPages = Math.ceil(dhammaData.length / ITEMS_PER_PAGE);
                currentPage = Math.floor(Math.random() * totalPages);
            }
            displayDhamma();
            scrollToTop();
        }
        
        // 搜索功能
        function searchDhamma() {
            const searchInput = document.getElementById('search-input');
            const keyword = searchInput.value.trim();
            
            if (!keyword) {
                clearSearch();
                return;
            }
            
            searchKeyword = keyword;
            isSearching = true;
            
            // 过滤包含关键词的法语,保留原始索引
            filteredDhammaData = dhammaData
                .map((item, index) => ({ text: item.sentence, url: item.url, index }))
                .filter(item => item.text.toLowerCase().includes(keyword.toLowerCase()));
            
            // 重置到第一页
            currentPage = 0;
            
            // 显示搜索结果信息
            const searchInfo = document.getElementById('search-info');
            searchInfo.textContent = `找到 ${filteredDhammaData.length} 条包含"${keyword}"的法语`;
            searchInfo.style.display = 'block';
            
            // 显示清除按钮
            document.getElementById('clear-btn').style.display = 'inline-block';
            
            // 更新显示
            displayDhamma();
        }
        
        // 清除搜索
        function clearSearch() {
            searchKeyword = '';
            isSearching = false;
            filteredDhammaData = [];
            currentPage = 0;
            
            // 重新生成随机索引
            randomIndices = generateRandomIndices(dhammaData.length);
            
            // 隐藏搜索信息
            document.getElementById('search-info').style.display = 'none';
            document.getElementById('clear-btn').style.display = 'none';
            
            // 清空输入框
            document.getElementById('search-input').value = '';
            
            // 更新显示
            displayDhamma();
        }
        
        // 高亮关键词
        function highlightKeyword(text, keyword) {
            if (!keyword) return text;
            
            const regex = new RegExp(`(${keyword})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }
        
        // 跳转到指定页
        function jumpToPage() {
            const input = document.getElementById('page-jump');
            const pageNum = parseInt(input.value);
            
            if (!pageNum || pageNum < 1) {
                alert('请输入有效的页码');
                return;
            }
            
            const dataSource = isSearching ? filteredDhammaData : dhammaData;
            const totalPages = Math.ceil(dataSource.length / ITEMS_PER_PAGE);
            
            if (pageNum > totalPages) {
                alert(`页码超出范围，当前共 ${totalPages} 页`);
                return;
            }
            
            currentPage = pageNum - 1;
            displayDhamma();
            scrollToTop();
            
            // 清空输入框
            input.value = '';
        }

        // 初始化类型过滤器
        function initTypeFilters() {
            const types = [...new Set(linksData.map(link => link.type))].filter(t => t !== null).sort();
            const typeNames = {
                1: '<i class="bi bi-book"></i> 经典文献',
                2: '<i class="bi bi-mic"></i> 开示讲座',
                3: '<i class="bi bi-globe"></i> 综合资源'
            };
            
            const filtersContainer = document.getElementById('type-filters');
            
            types.forEach(type => {
                const btn = document.createElement('button');
                btn.className = 'type-filter px-6 py-2 bg-white border-2 border-gray-200 text-gray-700 rounded-full hover:border-dharma-light transition-all duration-300 cursor-pointer flex items-center gap-1';
                btn.dataset.type = type;
                btn.innerHTML = typeNames[type] || `类型 ${type}`;
                btn.onclick = () => filterByType(type);
                filtersContainer.appendChild(btn);
            });
        }

        function filterByType(type) {
            currentFilter = type;
            
            // 更新按钮状态
            document.querySelectorAll('.type-filter').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type == type || (type === 'all' && btn.dataset.type === 'all'));
            });
            
            displayLinks();
        }

        // 显示书籍
        function displayBooks() {
            const grid = document.getElementById('books-grid');
            
            if (typeof BOOKS_DATA === 'undefined' || !BOOKS_DATA || BOOKS_DATA.length === 0) {
                grid.innerHTML = '<div class="text-center text-gray-400 col-span-full py-8">暂无书籍</div>';
                return;
            }
            
            grid.innerHTML = BOOKS_DATA.map(book => {
                return `
                    <div class="bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1">
                        <div class="flex items-start gap-4">
                            <div class="flex-shrink-0">
                                <div class="w-16 h-20 bg-gradient-to-br from-dharma-brown to-dharma-light rounded flex items-center justify-center text-white">
                                    <i class="bi bi-book text-3xl"></i>
                                </div>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-medium text-dharma-brown mb-1 line-clamp-2">${book.title}</h3>
                                ${book.author ? `<p class="text-sm text-gray-600 mb-2"><i class="bi bi-person"></i> ${book.author}</p>` : ''}
                                ${book.description ? `<p class="text-sm text-gray-500 mb-3 line-clamp-2">${book.description}</p>` : ''}
                                <div class="flex gap-2 flex-wrap">
                                    ${book.download ? `<a href="${book.download}" class="inline-flex items-center gap-1 px-3 py-1 bg-dharma-brown text-white text-sm rounded-full hover:bg-dharma-light transition-colors" download>
                                        <i class="bi bi-download"></i> 下载
                                    </a>` : ''}
                                    ${book.online ? `<a href="${book.online}" target="_blank" class="inline-flex items-center gap-1 px-3 py-1 bg-white border border-dharma-brown text-dharma-brown text-sm rounded-full hover:bg-dharma-brown hover:text-white transition-colors">
                                        <i class="bi bi-eye"></i> 在线阅读
                                    </a>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 显示链接
        function displayLinks() {
            const grid = document.getElementById('links-grid');
            
            const filteredLinks = currentFilter === 'all' 
                ? linksData 
                : linksData.filter(link => link.type == currentFilter);
            
            if (filteredLinks.length === 0) {
                grid.innerHTML = '<div class="text-center text-gray-400 col-span-full py-8">暂无资源</div>';
                return;
            }
            
            grid.innerHTML = filteredLinks.map(link => {
                const typeConfig = {
                    1: { name: '经典', color: '#059669', bgColor: '#d1fae5', borderColor: '#059669' },  // 绿色 - 经典文献
                    2: { name: '开示', color: '#dc2626', bgColor: '#fee2e2', borderColor: '#dc2626' },  // 红色 - 开示讲座
                    3: { name: '资源', color: '#2563eb', bgColor: '#dbeafe', borderColor: '#2563eb' }   // 蓝色 - 综合资源
                };
                
                const config = typeConfig[link.type] || { name: '其他', color: '#8d5a2a', bgColor: '#fdfbf7', borderColor: '#8d5a2a' };
                
                return `
                    <a href="${link.url}" target="_blank" class="block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border-2 hover:-translate-y-1 group" style="border-color: ${config.borderColor}33;">
                        <h3 class="text-lg font-medium mb-2 transition-colors" style="color: ${config.color};">${link.name || '未命名'}</h3>
                        ${link.type ? `<span class="inline-block px-3 py-1 rounded-full text-xs mb-2 font-medium" style="background-color: ${config.bgColor}; color: ${config.color};">${config.name}</span>` : ''}
                        <div class="text-xs text-gray-500 break-all opacity-70 mt-2">${link.url}</div>
                    </a>
                `;
            }).join('');
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
