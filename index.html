<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="baidu-site-verification" content="codeva-Tk7siYLedl" />
    <meta name="keywords" content="佛教 南传佛教 原始佛教 上座部佛教 佛陀的正法 阿含经 巴利三藏 禅修 自洲自依 法洲法依 正法律 巴利经典 别译杂阿含 尼柯耶 长部 中部 相应部 增支部 小部 杂阿含经 中阿含经 长阿含经 增一阿含经" />
    <meta name="description" content="法洲法依，自洲自依，分享佛陀正法、律、禅师法语、禅修经验，书籍推荐、下载，资源共享" />
    <title>法洲</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dharma-brown': '#8d5a2a',
                        'dharma-light': '#a67c52',
                        'dharma-bg': '#fdfbf7',
                    }
                }
            }
        }
    </script>
    <style>
        .highlight {
            background-color: #fef3c7;
            padding: 0 2px;
            font-weight: 500;
        }
        
        .dhamma-text {
            transition: opacity 0.3s ease;
        }
        
        .type-filter.active {
            background-color: #8d5a2a !important;
            border-color: #8d5a2a !important;
            color: white !important;
        }
        
        /* Material Design 3 样式 */
        .md3-container {
            background: linear-gradient(135deg, #fdfbf7 0%, #f9f5f0 100%);
            border-radius: 28px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 6px 16px rgba(141, 90, 42, 0.08);
        }
        
        .md3-search-field {
            background-color: #f5ebe0;
            border: 1px solid transparent;
            border-radius: 28px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .md3-search-field:hover {
            background-color: #f0e6db;
            box-shadow: 0 2px 4px rgba(141, 90, 42, 0.1);
        }
        
        .md3-search-field:focus {
            background-color: #fff;
            border-color: #8d5a2a;
            box-shadow: 0 2px 8px rgba(141, 90, 42, 0.15);
            outline: none;
        }
        
        .md3-fab {
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 4px 8px rgba(141, 90, 42, 0.2);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .md3-fab:hover {
            box-shadow: 0 2px 6px rgba(0,0,0,0.15), 0 8px 16px rgba(141, 90, 42, 0.25);
            transform: translateY(-1px);
        }
        
        .md3-fab:active {
            transform: translateY(0);
        }
        
        .md3-outlined-button {
            border: 1px solid #8d5a2a;
            border-radius: 20px;
            background-color: transparent;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .md3-outlined-button:hover {
            background-color: rgba(141, 90, 42, 0.08);
        }
        
        .md3-chip {
            border-radius: 8px;
            background-color: #f5ebe0;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .md3-chip:hover {
            background-color: #f0e6db;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .md3-surface {
            background-color: #fefefe;
            border-radius: 16px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .md3-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #e0e0e0 20%, #e0e0e0 80%, transparent);
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            15% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            85% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
        }
        
        /* 主题切换按钮 */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            width: 56px;
            height: 56px;
            border-radius: 28px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(141, 90, 42, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(141, 90, 42, 0.25);
            border-color: rgba(141, 90, 42, 0.4);
        }
        
        .theme-toggle i {
            font-size: 24px;
            color: #8d5a2a;
            transition: all 0.3s ease;
        }
        
        /* 暗色主题样式 */
        body.dark-theme {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        
        body.dark-theme .theme-toggle {
            background: rgba(30, 30, 30, 0.95);
            border-color: rgba(166, 124, 82, 0.3);
        }
        
        body.dark-theme .theme-toggle i {
            color: #d4a574;
        }
        
        body.dark-theme header {
            background: linear-gradient(135deg, #2d1810 0%, #3d2415 100%);
        }
        
        body.dark-theme .md3-container {
            background: linear-gradient(135deg, #252525 0%, #2a2a2a 100%);
            box-shadow: 0 1px 3px rgba(0,0,0,0.3), 0 6px 16px rgba(0, 0, 0, 0.4);
        }
        
        body.dark-theme .md3-search-field {
            background-color: #333;
            color: #e0e0e0;
            border-color: rgba(166, 124, 82, 0.2);
        }
        
        body.dark-theme .md3-search-field::placeholder {
            color: #888;
        }
        
        body.dark-theme .md3-search-field:hover {
            background-color: #3a3a3a;
        }
        
        body.dark-theme .md3-search-field:focus {
            background-color: #2a2a2a;
            border-color: #a67c52;
        }
        
        body.dark-theme .md3-chip {
            background-color: #333;
            color: #d0d0d0;
        }
        
        body.dark-theme .md3-chip:hover {
            background-color: #3a3a3a;
        }
        
        body.dark-theme .md3-surface {
            background-color: #2a2a2a;
            color: #e0e0e0;
        }
        
        body.dark-theme #dhamma-display {
            color: #e8e8e8;
        }
        
        body.dark-theme #dhamma-display > div > div:last-child {
            color: #d8d8d8;
        }
        
        body.dark-theme .md3-fab {
            background-color: #2a2a2a;
            color: #d4a574;
            border-color: rgba(166, 124, 82, 0.3);
        }
        
        body.dark-theme .md3-fab:hover {
            background-color: #333;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3), 0 8px 16px rgba(0, 0, 0, 0.4);
        }
        
        body.dark-theme .md3-outlined-button {
            border-color: #a67c52;
            color: #d4a574;
        }
        
        body.dark-theme .md3-outlined-button:hover {
            background-color: rgba(166, 124, 82, 0.15);
        }
        
        body.dark-theme #latest-dhamma {
            background: linear-gradient(135deg, #3a2816 0%, #442d1a 100%);
            border-color: #a67c52;
        }
        
        body.dark-theme #latest-dhamma-text {
            color: #e8d5c0;
        }
        
        body.dark-theme .highlight {
            background-color: #5a4a2a;
            color: #ffd966;
        }
        
        body.dark-theme .md3-divider {
            background: linear-gradient(90deg, transparent, #444 20%, #444 80%, transparent);
        }
        
        body.dark-theme section h2 {
            color: #d4a574;
        }
        
        body.dark-theme .bg-white {
            background-color: #2a2a2a !important;
        }
        
        body.dark-theme .text-gray-900 {
            color: #e8e8e8 !important;
        }
        
        body.dark-theme .text-gray-700 {
            color: #c0c0c0 !important;
        }
        
        body.dark-theme .text-gray-600 {
            color: #a0a0a0 !important;
        }
        
        body.dark-theme .text-gray-500 {
            color: #888 !important;
        }
        
        body.dark-theme .text-gray-400 {
            color: #666 !important;
        }
        
        body.dark-theme .border-gray-200 {
            border-color: rgba(166, 124, 82, 0.2) !important;
        }
        
        body.dark-theme .border-gray-100 {
            border-color: rgba(166, 124, 82, 0.15) !important;
        }
        
        body.dark-theme .shadow-md {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2) !important;
        }
        
        body.dark-theme .hover\:shadow-xl:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.3) !important;
        }
        
        body.dark-theme .hover\:shadow-lg:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
        }
        
        body.dark-theme .text-dharma-brown {
            color: #d4a574 !important;
        }
        
        body.dark-theme .group:hover .group-hover\:text-dharma-light {
            color: #e8c9a8 !important;
        }
        
        body.dark-theme footer {
            background-color: #1f1f1f;
            border-top-color: #333;
            color: #a0a0a0;
        }
        
        body.dark-theme #search-info {
            background-color: #2a3a4a;
            border-color: #3a4a5a;
            color: #c0d0e0;
        }
        
        /* 紧凑模式样式 */
        body.compact-mode .article-card,
        body.compact-mode .book-card,
        body.compact-mode .link-card {
            padding: 1rem !important;
        }
        
        body.compact-mode .article-card .icon-wrapper,
        body.compact-mode .book-card .icon-wrapper {
            width: 2.5rem !important;
            height: 2.5rem !important;
        }
        
        body.compact-mode .article-card .icon-wrapper i,
        body.compact-mode .book-card .icon-wrapper i {
            font-size: 1.25rem !important;
        }
        
        body.compact-mode .article-card h3,
        body.compact-mode .book-card h3,
        body.compact-mode .link-card h3 {
            font-size: 0.95rem !important;
            margin-bottom: 0.25rem !important;
        }
        
        body.compact-mode .article-card p,
        body.compact-mode .book-card p {
            font-size: 0.8rem !important;
            margin-bottom: 0.25rem !important;
        }
        
        body.compact-mode .article-card .tag-wrapper,
        body.compact-mode .book-card .book-actions {
            margin-top: 0.5rem !important;
            padding-top: 0.5rem !important;
        }
        
        body.compact-mode .book-card .book-actions a {
            padding: 0.4rem 0.8rem !important;
            font-size: 0.75rem !important;
        }
        
        body.compact-mode .link-card h3 {
            font-size: 0.95rem !important;
        }
        
        body.compact-mode .link-card .type-badge {
            padding: 0.25rem 0.5rem !important;
            font-size: 0.7rem !important;
        }
        
        body.compact-mode .link-card .url-display {
            font-size: 0.7rem !important;
            padding-top: 0.5rem !important;
        }
        
        body.compact-mode .link-card > div:first-child > div {
            width: 2rem !important;
            height: 2rem !important;
        }
        
        body.compact-mode .link-card > div:first-child > div i {
            font-size: 0.9rem !important;
        }
        
        /* 视图模式切换按钮 */
        .view-toggle {
            position: fixed;
            top: 90px;
            right: 20px;
            z-index: 1000;
            width: 56px;
            height: 56px;
            border-radius: 28px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(141, 90, 42, 0.2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            display: none;;
        }
        
        .view-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(141, 90, 42, 0.25);
            border-color: rgba(141, 90, 42, 0.4);
        }
        
        .view-toggle i {
            font-size: 24px;
            color: #8d5a2a;
            transition: all 0.3s ease;
        }
        
        body.dark-theme .view-toggle {
            background: rgba(30, 30, 30, 0.95);
            border-color: rgba(166, 124, 82, 0.3);
        }
        
        body.dark-theme .view-toggle i {
            color: #d4a574;
        }
        
        /* 留言板按钮 */
        .message-board-toggle {
            position: fixed;
            bottom: 30px;
            right: 20px;
            z-index: 1000;
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background: linear-gradient(135deg, #8d5a2a 0%, #a67c52 100%);
            box-shadow: 0 6px 20px rgba(141, 90, 42, 0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .message-board-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 24px rgba(141, 90, 42, 0.5);
        }
        
        .message-board-toggle i {
            font-size: 26px;
            color: white;
            transition: all 0.3s ease;
        }
        
        body.dark-theme .message-board-toggle {
            background: linear-gradient(135deg, #a67c52 0%, #d4a574 100%);
        }
        
        /* 留言板弹窗 */
        .message-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease;
        }
        
        .message-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .message-modal-content {
            background: white;
            border-radius: 28px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        body.dark-theme .message-modal-content {
            background: #2a2a2a;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        body.dark-theme .message-header {
            border-bottom-color: #404040;
        }
        
        .message-body {
            padding: 2rem;
            overflow-y: auto;
            flex: 1;
        }
        
        .message-item {
            background: #f9fafb;
            border-radius: 16px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border-left: 4px solid #8d5a2a;
            transition: all 0.3s ease;
        }
        
        .message-item:hover {
            background: #f3f4f6;
            transform: translateX(4px);
        }
        
        body.dark-theme .message-item {
            background: #1f1f1f;
            border-left-color: #d4a574;
        }
        
        body.dark-theme .message-item:hover {
            background: #252525;
        }
        
        .message-form {
            padding: 2rem;
            border-top: 1px solid #e5e7eb;
        }
        
        body.dark-theme .message-form {
            border-top-color: #404040;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #8d5a2a;
            box-shadow: 0 0 0 3px rgba(141, 90, 42, 0.1);
        }
        
        body.dark-theme .form-input {
            background: #1f1f1f;
            border-color: #404040;
            color: #e0e0e0;
        }
        
        body.dark-theme .form-input:focus {
            border-color: #d4a574;
            box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.1);
        }
        
        textarea.form-input {
            resize: vertical;
            min-height: 100px;
        }
        
        .submit-btn {
            width: 100%;
            padding: 0.875rem 1.5rem;
            background: linear-gradient(135deg, #8d5a2a 0%, #a67c52 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(141, 90, 42, 0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .close-modal-btn {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background: #f3f4f6;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-modal-btn:hover {
            background: #e5e7eb;
            transform: rotate(90deg);
        }
        
        body.dark-theme .close-modal-btn {
            background: #404040;
            color: #e0e0e0;
        }
        
        body.dark-theme .close-modal-btn:hover {
            background: #4a4a4a;
        }
        
        .tab-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .tab-btn {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #6b7280;
        }
        
        .tab-btn.active {
            background: #8d5a2a;
            border-color: #8d5a2a;
            color: white;
        }
        
        body.dark-theme .tab-btn {
            background: #1f1f1f;
            border-color: #404040;
            color: #9ca3af;
        }
        
        body.dark-theme .tab-btn.active {
            background: #d4a574;
            border-color: #d4a574;
            color: #1f1f1f;
        }
        
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #9ca3af;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body class="bg-dharma-bg font-sans">
    <!-- 主题切换按钮 -->
    <button class="theme-toggle" onclick="toggleTheme()" title="切换主题">
        <i id="theme-icon" class="bi bi-moon-stars-fill"></i>
    </button>
    
    <!-- 视图模式切换按钮 -->
    <button class="view-toggle" onclick="toggleViewMode()" title="切换视图密度">
        <i id="view-icon" class="bi bi-grid-3x3-gap-fill"></i>
    </button>
    
    <!-- 留言板按钮 -->
    <button class="message-board-toggle" onclick="openMessageBoard()" title="留言板">
        <i class="bi bi-chat-dots-fill"></i>
    </button>
    
    <!-- 留言板弹窗 -->
    <div class="message-modal" id="messageModal" onclick="closeMessageBoard(event)">
        <div class="message-modal-content" onclick="event.stopPropagation()">
            <!-- 头部 -->
            <div class="message-header">
                <h2 class="text-2xl font-medium text-dharma-brown flex items-center gap-2">
                    <i class="bi bi-chat-dots"></i>
                    <span>留言板</span>
                </h2>
                <button class="close-modal-btn" onclick="closeMessageBoard()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            
            <!-- 标签切换 -->
            <div style="padding: 1.5rem 2rem 0;">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('view')">
                        <i class="bi bi-list-ul"></i> 查看留言
                    </button>
                    <button class="tab-btn" onclick="switchTab('write')">
                        <i class="bi bi-pencil-square"></i> 写留言
                    </button>
                </div>
            </div>
            
            <!-- 留言列表 -->
            <div class="message-body" id="messageList">
                <div class="empty-state">
                    <i class="bi bi-hourglass-split"></i>
                    <p>加载中...</p>
                </div>
            </div>
            
            <!-- 留言表单 -->
            <div class="message-form" id="messageForm" style="display: none;">
                <div style="margin-bottom: 1rem;">
                    <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #8d5a2a;">
                        <i class="bi bi-person"></i> 昵称 <span style="color: #dc2626;">*</span>
                    </label>
                    <input type="text" id="username" class="form-input" placeholder="请输入您的昵称" required>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #8d5a2a;">
                        <i class="bi bi-envelope"></i> 邮箱（可选）
                    </label>
                    <input type="email" id="email" class="form-input" placeholder="your@email.com">
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label class="block text-sm font-medium text-gray-700 mb-2" style="color: #8d5a2a;">
                        <i class="bi bi-chat-text"></i> 留言内容 <span style="color: #dc2626;">*</span>
                    </label>
                    <textarea id="content" class="form-input" placeholder="分享您的感悟、问题或建议..." required></textarea>
                </div>
                
                <button class="submit-btn" onclick="submitMessage()">
                    <i class="bi bi-send"></i>
                    <span>提交留言</span>
                </button>
                
                <p class="text-xs text-gray-500 mt-3 text-center">
                    <i class="bi bi-info-circle"></i> 留言需要审核后才会显示
                </p>
            </div>
        </div>
    </div>
    
    <!-- Header -->
    <header class="bg-gradient-to-r from-dharma-brown to-dharma-light text-white py-10 px-4 shadow-lg">
        <h1 class="text-4xl md:text-5xl font-light tracking-widest text-center mb-2"><i class="bi bi-flower1"></i>法洲</h1>
        <p class="text-center text-sm md:text-base opacity-95">真理是最上之甘味</p>
    </header>

    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- 法语展示区 - Material Design 3 风格 -->
        <section class="md3-container p-6 md:p-12 mb-12">
            <!-- 标题区域 -->
            <div class="mb-8">
                <h2 class="text-3xl md:text-4xl font-medium text-dharma-brown mb-2 flex items-center gap-3">
                    <i class="bi bi-flower1 text-4xl"></i>
                    <span>法语甘露</span>
                </h2>
            </div>
            
            <!-- 最新法语 - 特别展示区 -->
            <div id="latest-dhamma" class="mb-8 bg-gradient-to-br from-amber-50 via-orange-50 to-yellow-50 rounded-3xl p-6 md:p-8 border-2 border-dharma-brown shadow-lg relative overflow-hidden">
                <!-- 装饰性背景 -->
                <div class="absolute top-0 right-0 w-32 h-32 bg-dharma-brown opacity-5 rounded-full -mr-16 -mt-16"></div>
                <div class="absolute bottom-0 left-0 w-24 h-24 bg-dharma-light opacity-5 rounded-full -ml-12 -mb-12"></div>
                
                <div class="relative z-10">
                    <!-- 标签 -->
                    <div class="flex items-center gap-2 mb-4">
                        <span class="inline-flex items-center gap-2 px-4 py-1.5 bg-dharma-brown text-white text-sm font-medium rounded-full shadow-sm">
                            <i class="bi bi-star-fill text-yellow-300"></i>
                            <span>最新法语</span>
                        </span>
                        <span class="text-xs text-gray-500">第 <span id="latest-number" class="font-medium text-dharma-brown">-</span> 条</span>
                    </div>
                    
                    <!-- 法语内容 -->
                    <div id="latest-dhamma-text" class="text-xl md:text-2xl leading-relaxed text-gray-800 font-medium mb-4">
                        加载中...
                    </div>
                    
                    <!-- 操作按钮 -->
                    <div class="flex flex-wrap gap-2 justify-end">
                        <button 
                            id="latest-copy-btn"
                            class="inline-flex items-center gap-2 px-4 py-2 bg-white border border-dharma-brown text-dharma-brown text-sm rounded-full hover:bg-dharma-brown hover:text-white transition-all duration-200 shadow-sm"
                            onclick="copyLatestDhamma()"
                        >
                            <i class="bi bi-clipboard"></i>
                            <span>复制</span>
                        </button>
                        <a 
                            id="latest-read-more"
                            href="#" 
                            class="inline-flex items-center gap-2 px-4 py-2 bg-dharma-brown text-white text-sm rounded-full hover:bg-dharma-light transition-all duration-200 shadow-sm"
                            target="_blank"
                            style="display:none;"
                        >
                            <i class="bi bi-arrow-right-circle"></i>
                            <span>阅读更多</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- 搜索栏 - MD3 风格 -->
            <div class="mb-8">
                <div class="flex gap-3">
                    <div class="flex-1 relative">
                        <i class="bi bi-search absolute left-5 top-1/2 -translate-y-1/2 text-gray-500 text-lg"></i>
                        <input 
                            type="text" 
                            id="search-input" 
                            class="md3-search-field w-full pl-14 pr-32 py-4 text-base"
                            placeholder="搜索法语..." 
                            onkeypress="if(event.key==='Enter') searchDhamma()"
                        >
                        <button 
                            class="absolute right-2 top-1/2 -translate-y-1/2 px-6 py-2 bg-dharma-brown text-white font-medium rounded-full flex items-center gap-2 hover:bg-dharma-light transition-all duration-200 shadow-sm hover:shadow-md"
                            onclick="searchDhamma()"
                        >
                            <i class="bi bi-search"></i>
                            <span class="hidden sm:inline">搜索</span>
                        </button>
                    </div>
                    <button 
                        class="md3-outlined-button px-6 py-4 text-dharma-brown font-medium flex items-center gap-2 flex-shrink-0"
                        onclick="clearSearch()" 
                        id="clear-btn" 
                        style="display:none;"
                    >
                        <i class="bi bi-x-lg"></i>
                        <span>清除</span>
                    </button>
                </div>
            </div>
            
            <!-- 页码跳转 - MD3 Chip 风格 -->
            <div class="flex flex-wrap gap-3 mb-8 items-center justify-center">
                <div class="md3-chip px-4 py-2 flex items-center gap-2">
                    <span class="text-sm text-gray-700">跳转至</span>
                    <input 
                        type="number" 
                        id="page-jump" 
                        min="1"
                        class="w-16 px-2 py-1 bg-white border border-gray-300 rounded-lg text-center text-sm focus:outline-none focus:border-dharma-brown" 
                        placeholder="1"
                        onkeypress="if(event.key==='Enter') jumpToPage()"
                    >
                    <span class="text-sm text-gray-700">页</span>
                    <span class="text-sm text-gray-500 ml-1">/ 共 <span id="total-pages" class="font-medium text-dharma-brown">-</span> 页</span>
                </div>
                <button 
                    class="md3-chip px-5 py-2 text-sm font-medium text-dharma-brown flex items-center gap-2 hover:shadow-md"
                    onclick="jumpToPage()"
                >
                    <i class="bi bi-arrow-right-short text-lg"></i>
                    跳转
                </button>
            </div>
            
            <!-- 搜索结果信息 - MD3 风格 -->
            <div id="search-info" class="text-gray-700 text-sm text-center mb-6 py-3 px-6 bg-blue-50 rounded-2xl border border-blue-100" style="display:none;"></div>
            
            <!-- 法语内容区域 - MD3 Surface -->
            <div class="md3-surface p-8 mb-8 min-h-[280px] flex items-center justify-center">
                <div id="dhamma-display" class="dhamma-text text-lg md:text-xl leading-loose text-gray-800 w-full">
                    <div class="text-center text-gray-400 flex flex-col items-center gap-3">
                        <i class="bi bi-hourglass-split text-3xl"></i>
                        <span>加载中...</span>
                    </div>
                </div>
            </div>
            
            <!-- 分页控制 - MD3 风格 -->
            <div class="md3-divider my-6"></div>
            <div class="flex flex-col sm:flex-row justify-between items-center gap-6 pt-4">
                <div class="flex gap-2 items-center">
                    <button 
                        id="prev-btn" 
                        onclick="prevPage()"
                        class="md3-fab px-5 py-3 bg-white border border-gray-200 text-dharma-brown disabled:opacity-40 disabled:cursor-not-allowed flex items-center gap-2 font-medium"
                    >
                        <i class="bi bi-chevron-left"></i>
                        <span>上一页</span>
                    </button>
                    <div class="md3-chip px-4 py-3 min-w-[140px] text-center">
                        <span id="page-info" class="text-sm font-medium text-gray-700">-</span>
                    </div>
                    <button 
                        id="next-btn" 
                        onclick="nextPage()"
                        class="md3-fab px-5 py-3 bg-white border border-gray-200 text-dharma-brown disabled:opacity-40 disabled:cursor-not-allowed flex items-center gap-2 font-medium"
                    >
                        <span>下一页</span>
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
                <button 
                    class="md3-fab px-6 py-3 bg-gradient-to-r from-dharma-brown to-dharma-light text-white font-medium flex items-center gap-2"
                    onclick="randomQuote()"
                >
                    <i class="bi bi-shuffle"></i>
                    <span>随机浏览</span>
                </button>
            </div>
        </section>

        <!-- 文章专栏区 -->
        <section class="mb-12">
            <h2 class="text-2xl md:text-3xl font-normal text-dharma-brown mb-6 text-center flex items-center justify-center gap-2">
                <i class="bi bi-journal-text"></i>
                <span>法义文章</span>
            </h2>
            
            <!-- 文章列表 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- 文章卡片 1 -->
                <a href="article/四大法教.html" class="article-card block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 icon-wrapper">
                            <div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center text-white">
                                <i class="bi bi-file-text text-2xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-medium text-dharma-brown mb-2 group-hover:text-dharma-light transition-colors">关于四大法教</h3>
                            <p class="text-sm text-gray-500 mb-2 line-clamp-2">增支部AN VII.80经文解读，清晰定义法与律的标准</p>
                            <div class="tag-wrapper flex items-center gap-2 text-xs text-gray-400">
                                <i class="bi bi-tag"></i>
                                <span>法教 · 经典</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- 文章卡片 2 -->
                <a href="article/圣者与凡夫的不同视角.html" class="article-card block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 icon-wrapper">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center text-white">
                                <i class="bi bi-eye text-2xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-medium text-dharma-brown mb-2 group-hover:text-dharma-light transition-colors">圣者与凡夫的不同视角</h3>
                            <p class="text-sm text-gray-500 mb-2 line-clamp-2">相应部35相应80经解读，断除无明的知见</p>
                            <div class="tag-wrapper flex items-center gap-2 text-xs text-gray-400">
                                <i class="bi bi-tag"></i>
                                <span>无明 · 六根</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- 文章卡片 3 -->
                <a href="article/心生迫切感.html" class="article-card block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 icon-wrapper">
                            <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center text-white">
                                <i class="bi bi-heart-pulse text-2xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-medium text-dharma-brown mb-2 group-hover:text-dharma-light transition-colors">心生迫切感</h3>
                            <p class="text-sm text-gray-500 mb-2 line-clamp-2">班迪达大师开示，无常与无财产的真相</p>
                            <div class="tag-wrapper flex items-center gap-2 text-xs text-gray-400">
                                <i class="bi bi-tag"></i>
                                <span>无常 · 禅修</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- 文章卡片 4 -->
                <a href="article/如何证果.html" class="article-card block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 icon-wrapper">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center text-white">
                                <i class="bi bi-trophy text-2xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-medium text-dharma-brown mb-2 group-hover:text-dharma-light transition-colors">如何证果</h3>
                            <p class="text-sm text-gray-500 mb-2 line-clamp-2">舍利弗尊者开示如理作意五取蕴以证得圣果</p>
                            <div class="tag-wrapper flex items-center gap-2 text-xs text-gray-400">
                                <i class="bi bi-tag"></i>
                                <span>五取蕴 · 证果</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- 文章卡片 5 -->
                <a href="article/内观定.html" class="article-card block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 icon-wrapper">
                            <div class="w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-lg flex items-center justify-center text-white">
                                <i class="bi bi-droplet text-2xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-medium text-dharma-brown mb-2 group-hover:text-dharma-light transition-colors">内观定</h3>
                            <p class="text-sm text-gray-500 mb-2 line-clamp-2">德加尼亚禅师开示内观定与止禅定的区别</p>
                            <div class="tag-wrapper flex items-center gap-2 text-xs text-gray-400">
                                <i class="bi bi-tag"></i>
                                <span>内观定 · 正精进</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- 文章卡片 6 -->
                <a href="article/亲近智者.html" class="article-card block bg-white rounded-lg shadow-md hover:shadow-xl transition-all duration-300 p-6 border border-transparent hover:border-dharma-brown hover:-translate-y-1 group">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0 icon-wrapper">
                            <div class="w-12 h-12 bg-gradient-to-br from-rose-500 to-pink-600 rounded-lg flex items-center justify-center text-white">
                                <i class="bi bi-people text-2xl"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-medium text-dharma-brown mb-2 group-hover:text-dharma-light transition-colors">亲近智者</h3>
                            <p class="text-sm text-gray-500 mb-2 line-clamp-2">菩提比丘开示善友对灵性发展的重要性</p>
                            <div class="tag-wrapper flex items-center gap-2 text-xs text-gray-400">
                                <i class="bi bi-tag"></i>
                                <span>善知识 · 大吉祥经</span>
                            </div>
                        </div>
                    </div>
                </a>
                
                <!-- 可以继续添加更多文章 -->
            </div>
        </section>

        <!-- 书籍下载区 -->
        <section class="mb-12">
            <h2 class="text-2xl md:text-3xl font-normal text-dharma-brown mb-6 text-center flex items-center justify-center gap-2">
                <i class="bi bi-book"></i>
                <span>推荐书籍下载</span>
            </h2>
            
            <!-- 书籍网格 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="books-grid">
                <div class="text-center text-gray-400 col-span-full py-8">加载中...</div>
            </div>
        </section>

        <!-- 资源链接区 -->
        <section class="mb-12">
            <h2 class="text-2xl md:text-3xl font-normal text-dharma-brown mb-6 text-center flex items-center justify-center gap-2">
                <i class="bi bi-link-45deg"></i>
                <span>佛法资源链接</span>
            </h2>
            
            <!-- 类型过滤器 -->
            <div class="flex justify-center gap-3 mb-8 flex-wrap" id="type-filters">
                <button class="type-filter px-6 py-2 bg-white border-2 border-gray-200 text-gray-700 rounded-full hover:border-dharma-light transition-all duration-300 active:bg-dharma-brown active:border-dharma-brown active:text-white" data-type="all" onclick="filterByType('all')">
                    全部
                </button>
            </div>
            
            <!-- 链接网格 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="links-grid">
                <div class="text-center text-gray-400 col-span-full py-8">加载中...</div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 py-8 text-center text-gray-600 text-sm mt-12">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col items-center gap-3">
                <p class="text-dharma-brown font-medium">&copy; 2025 法洲 | 愿正法久住</p>
                <div class="flex items-center gap-2 text-gray-500 hover:text-dharma-brown transition-colors">
                    <i class="bi bi-envelope-fill"></i>
                    <a href="mailto:paccakkha@yahoo.com" class="hover:underline">paccakkha@yahoo.com</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="link.js"></script>
    <script src="dhamma.js"></script>
    <script src="book.js"></script>
    <script>
        // 初始化 Supabase
        const SUPABASE_URL = 'https://hjrfufuyivgddqpzdrzp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqcmZ1ZnV5aXZnZGRxcHpkcnpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0MDU3NTAsImV4cCI6MjA3OTk4MTc1MH0.EyFBzpiBuOy9Cm9nwNB-_c7j77Ny8E1F13ltB3BXojs';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let currentTab = 'view';
        
        // 打开留言板
        function openMessageBoard() {
            document.getElementById('messageModal').classList.add('active');
            if (currentTab === 'view') {
                loadMessages();
            }
        }
        
        // 关闭留言板
        function closeMessageBoard(event) {
            if (!event || event.target.id === 'messageModal') {
                document.getElementById('messageModal').classList.remove('active');
            }
        }
        
        // 切换标签
        function switchTab(tab) {
            currentTab = tab;
            
            // 更新标签按钮状态
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.tab-btn').classList.add('active');
            
            // 切换显示内容
            const messageList = document.getElementById('messageList');
            const messageForm = document.getElementById('messageForm');
            
            if (tab === 'view') {
                messageList.style.display = 'block';
                messageForm.style.display = 'none';
                loadMessages();
            } else {
                messageList.style.display = 'none';
                messageForm.style.display = 'block';
            }
        }
        
        // 加载留言
        async function loadMessages() {
            const messageList = document.getElementById('messageList');
            messageList.innerHTML = `
                <div class="empty-state">
                    <i class="bi bi-hourglass-split"></i>
                    <p>加载中...</p>
                </div>
            `;
            
            try {
                const { data, error } = await supabase
                    .from('messages')
                    .select('*')
                    .eq('is_approved', true)
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                if (!data || data.length === 0) {
                    messageList.innerHTML = `
                        <div class="empty-state">
                            <i class="bi bi-chat-dots"></i>
                            <p>暂无留言，来写第一条吧！</p>
                        </div>
                    `;
                    return;
                }
                
                messageList.innerHTML = data.map(msg => {
                    const date = new Date(msg.created_at);
                    const formattedDate = date.toLocaleDateString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    return `
                        <div class="message-item">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div style="width: 32px; height: 32px; border-radius: 16px; background: linear-gradient(135deg, #8d5a2a 0%, #a67c52 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9rem;">
                                        ${msg.username.charAt(0).toUpperCase()}
                                    </div>
                                    <span style="font-weight: 500; color: #8d5a2a;">${escapeHtml(msg.username)}</span>
                                </div>
                                <span style="font-size: 0.75rem; color: #9ca3af;">
                                    <i class="bi bi-clock"></i> ${formattedDate}
                                </span>
                            </div>
                            <p style="color: #4b5563; line-height: 1.6; white-space: pre-wrap;">${escapeHtml(msg.content)}</p>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('加载留言失败:', error);
                messageList.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-exclamation-triangle"></i>
                        <p>加载失败，请稍后重试</p>
                    </div>
                `;
            }
        }
        
        // 提交留言
        async function submitMessage() {
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const content = document.getElementById('content').value.trim();
            
            if (!username || !content) {
                alert('请填写昵称和留言内容');
                return;
            }
            
            // 验证邮箱格式（如果填写了）
            if (email && !isValidEmail(email)) {
                alert('请输入有效的邮箱地址');
                return;
            }
            
            const submitBtn = event.target;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> 提交中...';
            
            try {
                const { data, error } = await supabase
                    .from('messages')
                    .insert([
                        {
                            username: username,
                            email: email || null,
                            content: content,
                            is_approved: false
                        }
                    ]);
                
                if (error) throw error;
                
                // 清空表单
                document.getElementById('username').value = '';
                document.getElementById('email').value = '';
                document.getElementById('content').value = '';
                
                // 显示成功消息
                showToast('✓ 留言提交成功，等待审核后显示');
                
                // 切换到查看标签
                setTimeout(() => {
                    document.querySelectorAll('.tab-btn')[0].click();
                }, 1500);
                
            } catch (error) {
                console.error('提交留言失败:', error);
                showToast('✗ 提交失败，请稍后重试', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="bi bi-send"></i> <span>提交留言</span>';
            }
        }
        
        // HTML 转义函数
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // 验证邮箱
        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        // 显示提示消息
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.textContent = message;
            const bgColor = type === 'success' ? '#8d5a2a' : '#dc2626';
            toast.style.cssText = `position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: ${bgColor}; color: white; padding: 16px 32px; border-radius: 28px; font-size: 15px; z-index: 9999; box-shadow: 0 8px 24px rgba(0,0,0,0.2); animation: fadeInOut 3s ease-in-out;`;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        let dhammaData = DHAMMA_DATA;
        let linksData = LINKS_DATA;
        let currentPage = 0;
        let currentFilter = 'all';
        const ITEMS_PER_PAGE = 5;
        
        // 搜索相关变量
        let searchKeyword = '';
        let filteredDhammaData = [];
        let isSearching = false;
        
        // 随机显示相关变量
        let randomIndices = [];

        // 生成随机索引数组
        function generateRandomIndices(dataLength) {
            const indices = Array.from({ length: dataLength }, (_, i) => i);
            // Fisher-Yates 洗牌算法
            for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
            return indices;
        }

        // 页面加载后初始化
        function initPage() {
            // 显示最新法语
            displayLatestDhamma();
            
            // 生成随机索引(仅在非搜索模式下)
            if (!isSearching) {
                randomIndices = generateRandomIndices(dhammaData.length);
            }
            
            // 初始化法语显示
            displayDhamma();
            
            // 显示书籍
            displayBooks();
            
            // 初始化分类过滤器
            initTypeFilters();
            
            // 显示链接
            displayLinks();
        }
        
        // 显示最新法语
        function displayLatestDhamma() {
            if (!dhammaData || dhammaData.length === 0) return;
            
            const latestIndex = dhammaData.length - 1;
            const latestItem = dhammaData[latestIndex];
            const text = latestItem.sentence || '';
            const url = latestItem.url || '';
            
            // 更新法语编号
            document.getElementById('latest-number').textContent = latestIndex + 1;
            
            // 更新法语内容 (支持HTML标签)
            document.getElementById('latest-dhamma-text').innerHTML = text;
            
            // 存储纯文本用于复制
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = text;
            window.latestDhammaText = tempDiv.textContent || tempDiv.innerText || text;
            
            // 如果有链接，显示"阅读更多"按钮
            const readMoreBtn = document.getElementById('latest-read-more');
            if (url && url !== '') {
                readMoreBtn.href = url;
                readMoreBtn.style.display = 'inline-flex';
            } else {
                readMoreBtn.style.display = 'none';
            }
        }
        
        // 复制最新法语
        function copyLatestDhamma() {
            const text = window.latestDhammaText || '';
            
            navigator.clipboard.writeText(text).then(() => {
                // 显示复制成功提示
                const toast = document.createElement('div');
                toast.textContent = '✓ 已复制最新法语';
                toast.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #8d5a2a; color: white; padding: 12px 24px; border-radius: 28px; font-size: 14px; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.15); animation: fadeInOut 2s ease-in-out;';
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }).catch(err => {
                alert('复制失败，请手动复制');
                console.error('复制失败:', err);
            });
        }

        // 显示当前页法语
        function displayDhamma() {
            const dataSource = isSearching ? filteredDhammaData : dhammaData;
            if (dataSource.length === 0) {
                document.getElementById('dhamma-display').innerHTML = '<div style="text-align:center;color:#999;">未找到匹配的法语</div>';
                document.getElementById('page-info').textContent = '无结果';
                document.getElementById('prev-btn').disabled = true;
                document.getElementById('next-btn').disabled = true;
                return;
            }
            
            const display = document.getElementById('dhamma-display');
            let items;
            
            if (isSearching) {
                // 搜索模式:按顺序显示搜索结果
                const startIdx = currentPage * ITEMS_PER_PAGE;
                const endIdx = Math.min(startIdx + ITEMS_PER_PAGE, dataSource.length);
                items = dataSource.slice(startIdx, endIdx);
            } else {
                // 非搜索模式:使用随机索引
                const startIdx = currentPage * ITEMS_PER_PAGE;
                const endIdx = Math.min(startIdx + ITEMS_PER_PAGE, randomIndices.length);
                items = randomIndices.slice(startIdx, endIdx).map(idx => ({
                    text: dhammaData[idx].sentence,
                    url: dhammaData[idx].url,
                    index: idx
                }));
            }
            
            display.style.opacity = '0';
            setTimeout(() => {
                // 使用编号列表显示多条法语,带关键词高亮
                display.innerHTML = items.map((item, idx) => {
                    const text = item.text || item.sentence || item;
                    const url = item.url || '';
                    const highlightedText = isSearching ? highlightKeyword(text, searchKeyword) : text;
                    const actualIdx = item.index !== undefined ? item.index : currentPage * ITEMS_PER_PAGE + idx;
                    
                    // 转义引号以便在HTML属性中使用
                    const escapedText = text.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
                    
                    let content = `<div style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; ${idx < items.length - 1 ? 'border-bottom: 1px solid #e0e0e0;' : ''}">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <div style="color: #a67c52; font-size: 0.85rem;">第 ${actualIdx + 1} 条</div>
                            <button onclick="copyDhamma('${escapedText}')" style="color: #8d5a2a; background: transparent; border: 1px solid #e0e0e0; border-radius: 8px; padding: 0.25rem 0.5rem; font-size: 0.8rem; cursor: pointer; display: inline-flex; align-items: center; gap: 0.25rem; transition: all 0.2s;" onmouseover="this.style.backgroundColor='#fdfbf7'; this.style.borderColor='#8d5a2a'" onmouseout="this.style.backgroundColor='transparent'; this.style.borderColor='#e0e0e0'" title="复制法语">
                                <i class="bi bi-clipboard"></i>
                                <span>复制</span>
                            </button>
                        </div>
                        <div>${highlightedText}</div>`;
                    
                    if (url && url !== '') {
                        content += `<div style="margin-top: 0.75rem; text-align: right;"><a href="${url}" style="color: #8d5a2a; text-decoration: none; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.25rem 0.5rem; border-radius: 0.375rem; transition: all 0.3s; background-color: #fdfbf7;" target="_blank" onmouseover="this.style.backgroundColor='#f5ebe0'" onmouseout="this.style.backgroundColor='#fdfbf7'"><i class="bi bi-arrow-right-circle"></i> 阅读更多</a></div>`;
                    }
                    
                    content += `</div>`;
                    return content;
                }).join('');
                
                display.style.opacity = '1';
            }, 150);
            
            // 更新页码信息
            const totalPages = Math.ceil(dataSource.length / ITEMS_PER_PAGE);
            document.getElementById('page-info').textContent = `第 ${currentPage + 1} 页 / 共 ${totalPages} 页`;
            document.getElementById('total-pages').textContent = totalPages;
            
            // 更新按钮状态
            document.getElementById('prev-btn').disabled = currentPage === 0;
            document.getElementById('next-btn').disabled = (currentPage + 1) * ITEMS_PER_PAGE >= dataSource.length;
        }

        function prevPage() {
            if (currentPage > 0) {
                currentPage--;
                displayDhamma();
                scrollToTop();
            }
        }

        function nextPage() {
            const dataSource = isSearching ? filteredDhammaData : dhammaData;
            const totalPages = Math.ceil(dataSource.length / ITEMS_PER_PAGE);
            if (currentPage < totalPages - 1) {
                currentPage++;
                displayDhamma();
                scrollToTop();
            }
        }
        
        function scrollToTop() {
            const displayElement = document.getElementById('dhamma-display');
            if (displayElement) {
                // 检测是否为移动设备（屏幕宽度小于768px）
                const isMobile = window.innerWidth < 768;
                // 移动端滚动到顶部，桌面端滚动到中间
                displayElement.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: isMobile ? 'start' : 'center' 
                });
            }
        }
        
        // 复制法语文本
        function copyDhamma(text) {
            // 移除HTML标签，只保留纯文本
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = text;
            const plainText = tempDiv.textContent || tempDiv.innerText || '';
            
            navigator.clipboard.writeText(plainText).then(() => {
                // 显示复制成功提示
                const toast = document.createElement('div');
                toast.textContent = '✓ 已复制';
                toast.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #8d5a2a; color: white; padding: 12px 24px; border-radius: 28px; font-size: 14px; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.15); animation: fadeInOut 2s ease-in-out;';
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 2000);
            }).catch(err => {
                alert('复制失败，请手动复制');
                console.error('复制失败:', err);
            });
        }

        function randomQuote() {
            if (isSearching) {
                // 搜索模式:随机跳转到某页
                const totalPages = Math.ceil(filteredDhammaData.length / ITEMS_PER_PAGE);
                currentPage = Math.floor(Math.random() * totalPages);
            } else {
                // 非搜索模式:重新生成随机索引并跳转到随机页
                randomIndices = generateRandomIndices(dhammaData.length);
                const totalPages = Math.ceil(dhammaData.length / ITEMS_PER_PAGE);
                currentPage = Math.floor(Math.random() * totalPages);
            }
            displayDhamma();
            scrollToTop();
        }
        
        // 搜索功能
        function searchDhamma() {
            const searchInput = document.getElementById('search-input');
            const keyword = searchInput.value.trim();
            
            if (!keyword) {
                clearSearch();
                return;
            }
            
            searchKeyword = keyword;
            isSearching = true;
            
            // 过滤包含关键词的法语,保留原始索引
            filteredDhammaData = dhammaData
                .map((item, index) => ({ text: item.sentence, url: item.url, index }))
                .filter(item => item.text.toLowerCase().includes(keyword.toLowerCase()));
            
            // 重置到第一页
            currentPage = 0;
            
            // 显示搜索结果信息
            const searchInfo = document.getElementById('search-info');
            searchInfo.textContent = `找到 ${filteredDhammaData.length} 条包含"${keyword}"的法语`;
            searchInfo.style.display = 'block';
            
            // 显示清除按钮
            document.getElementById('clear-btn').style.display = 'inline-block';
            
            // 更新显示
            displayDhamma();
        }
        
        // 清除搜索
        function clearSearch() {
            searchKeyword = '';
            isSearching = false;
            filteredDhammaData = [];
            currentPage = 0;
            
            // 重新生成随机索引
            randomIndices = generateRandomIndices(dhammaData.length);
            
            // 隐藏搜索信息
            document.getElementById('search-info').style.display = 'none';
            document.getElementById('clear-btn').style.display = 'none';
            
            // 清空输入框
            document.getElementById('search-input').value = '';
            
            // 更新显示
            displayDhamma();
        }
        
        // 高亮关键词
        function highlightKeyword(text, keyword) {
            if (!keyword) return text;
            
            const regex = new RegExp(`(${keyword})`, 'gi');
            return text.replace(regex, '<span class="highlight">$1</span>');
        }
        
        // 跳转到指定页
        function jumpToPage() {
            const input = document.getElementById('page-jump');
            const pageNum = parseInt(input.value);
            
            if (!pageNum || pageNum < 1) {
                alert('请输入有效的页码');
                return;
            }
            
            const dataSource = isSearching ? filteredDhammaData : dhammaData;
            const totalPages = Math.ceil(dataSource.length / ITEMS_PER_PAGE);
            
            if (pageNum > totalPages) {
                alert(`页码超出范围，当前共 ${totalPages} 页`);
                return;
            }
            
            currentPage = pageNum - 1;
            displayDhamma();
            scrollToTop();
            
            // 清空输入框
            input.value = '';
        }

        // 初始化类型过滤器
        function initTypeFilters() {
            const types = [...new Set(linksData.map(link => link.type))].filter(t => t !== null).sort();
            const typeNames = {
                1: '<i class="bi bi-book"></i> 经典文献',
                2: '<i class="bi bi-mic"></i> 开示讲座',
                3: '<i class="bi bi-globe"></i> 综合资源'
            };
            
            const filtersContainer = document.getElementById('type-filters');
            
            types.forEach(type => {
                const btn = document.createElement('button');
                btn.className = 'type-filter px-6 py-2 bg-white border-2 border-gray-200 text-gray-700 rounded-full hover:border-dharma-light transition-all duration-300 cursor-pointer flex items-center gap-1';
                btn.dataset.type = type;
                btn.innerHTML = typeNames[type] || `类型 ${type}`;
                btn.onclick = () => filterByType(type);
                filtersContainer.appendChild(btn);
            });
        }

        function filterByType(type) {
            currentFilter = type;
            
            // 更新按钮状态
            document.querySelectorAll('.type-filter').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type == type || (type === 'all' && btn.dataset.type === 'all'));
            });
            
            displayLinks();
        }

        // 显示书籍
        function displayBooks() {
            const grid = document.getElementById('books-grid');
            
            if (typeof BOOKS_DATA === 'undefined' || !BOOKS_DATA || BOOKS_DATA.length === 0) {
                grid.innerHTML = '<div class="text-center text-gray-400 col-span-full py-8">暂无书籍</div>';
                return;
            }
            
            grid.innerHTML = BOOKS_DATA.map(book => {
                return `
                    <div class="book-card bg-white rounded-3xl transition-all duration-300 p-6 border border-gray-100 hover:shadow-lg overflow-hidden">
                        <!-- 顶部书名区域 -->
                        <div class="mb-4 flex items-start gap-3">
                            <div class="flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center text-dharma-brown bg-dharma-brown bg-opacity-10">
                                <i class="bi bi-journal-text text-xl"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-medium text-gray-900 mb-2 line-clamp-2 leading-snug">${book.title}</h3>
                                ${book.author ? `<p class="text-sm text-gray-500 flex items-center gap-1.5">
                                    <i class="bi bi-person text-dharma-brown"></i>
                                    <span>${book.author}</span>
                                </p>` : ''}
                            </div>
                        </div>
                        
                        <!-- 描述区域 -->
                        ${book.description ? `<p class="text-sm text-gray-600 mb-4 line-clamp-3 leading-relaxed">${book.description}</p>` : ''}
                        
                        <!-- 底部操作按钮区域 -->
                        <div class="book-actions flex gap-2 pt-4 border-t border-gray-100">
                            ${book.download ? `<a href="${book.download}" class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-white text-dharma-brown text-sm font-medium rounded-xl hover:bg-dharma-brown hover:text-white transition-all duration-200 border-2 border-dharma-brown" download>
                                <i class="bi bi-download text-base"></i>
                                <span>下载</span>
                            </a>` : ''}
                            ${book.online ? `<a href="${book.online}" target="_blank" class="flex-1 inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-white text-gray-600 text-sm font-medium rounded-xl hover:bg-gray-50 transition-all duration-200 border-2 border-gray-300 hover:border-gray-400">
                                <i class="bi bi-eye text-base"></i>
                                <span>阅读</span>
                            </a>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 显示链接
        function displayLinks() {
            const grid = document.getElementById('links-grid');
            
            const filteredLinks = currentFilter === 'all' 
                ? linksData 
                : linksData.filter(link => link.type == currentFilter);
            
            if (filteredLinks.length === 0) {
                grid.innerHTML = '<div class="text-center text-gray-400 col-span-full py-8">暂无资源</div>';
                return;
            }
            
            grid.innerHTML = filteredLinks.map(link => {
                const typeConfig = {
                    1: { name: '经典', icon: 'book', color: '#059669', bgColor: 'rgba(5, 150, 105, 0.1)' },
                    2: { name: '开示', icon: 'mic', color: '#dc2626', bgColor: 'rgba(220, 38, 38, 0.1)' },
                    3: { name: '资源', icon: 'globe2', color: '#2563eb', bgColor: 'rgba(37, 99, 235, 0.1)' }
                };
                
                const config = typeConfig[link.type] || { name: '其他', icon: 'link-45deg', color: '#8d5a2a', bgColor: 'rgba(141, 90, 42, 0.1)' };
                
                return `
                    <a href="${link.url}" target="_blank" class="link-card block bg-white rounded-3xl transition-all duration-300 p-6 border border-gray-100 hover:shadow-lg group">
                        <!-- 顶部标题和图标 -->
                        <div class="flex items-start justify-between gap-3 mb-3">
                            <h3 class="text-lg font-medium text-gray-900 line-clamp-2 leading-snug flex-1">${link.name || '未命名'}</h3>
                            <div class="flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center" style="background-color: ${config.bgColor}; color: ${config.color};">
                                <i class="bi bi-${config.icon} text-lg"></i>
                            </div>
                        </div>
                        
                        <!-- 类型标签 -->
                        ${link.type ? `<div class="mb-3">
                            <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium" style="background-color: ${config.bgColor}; color: ${config.color};">
                                <i class="bi bi-tag"></i>
                                <span>${config.name}</span>
                            </span>
                        </div>` : ''}
                        
                        <!-- URL 显示 -->
                        <div class="url-display flex items-center gap-2 pt-3 border-t border-gray-100">
                            <i class="bi bi-link-45deg text-gray-400 flex-shrink-0"></i>
                            <span class="text-xs text-gray-500 truncate">${link.url}</span>
                            <i class="bi bi-box-arrow-up-right text-gray-400 flex-shrink-0 text-xs ml-auto opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </div>
                    </a>
                `;
            }).join('');
        }

        // 视图模式切换功能
        function toggleViewMode() {
            const body = document.body;
            const viewIcon = document.getElementById('view-icon');
            const isCompact = body.classList.toggle('compact-mode');
            
            // 更新图标
            if (isCompact) {
                viewIcon.className = 'bi bi-grid-fill';
                localStorage.setItem('viewMode', 'compact');
            } else {
                viewIcon.className = 'bi bi-grid-3x3-gap-fill';
                localStorage.setItem('viewMode', 'normal');
            }
        }
        
        // 页面加载时恢复视图模式设置
        function loadViewMode() {
            const savedViewMode = localStorage.getItem('viewMode');
            const viewIcon = document.getElementById('view-icon');
            
            if (savedViewMode === 'compact') {
                document.body.classList.add('compact-mode');
                viewIcon.className = 'bi bi-grid-fill';
            }
        }

        // 主题切换功能
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.getElementById('theme-icon');
            const isDark = body.classList.toggle('dark-theme');
            
            // 更新图标
            if (isDark) {
                themeIcon.className = 'bi bi-sun-fill';
                localStorage.setItem('theme', 'dark');
            } else {
                themeIcon.className = 'bi bi-moon-stars-fill';
                localStorage.setItem('theme', 'light');
            }
        }
        
        // 页面加载时恢复主题设置
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            const themeIcon = document.getElementById('theme-icon');
            
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                themeIcon.className = 'bi bi-sun-fill';
            }
        }
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadViewMode();
            initPage();
        });
    </script>
</body>
</html>
